// Softstarter.c
// Runs on TM4C123, 
// Unisinos TGA Eletrônica 4 
// Gabriel Magri, Jaqueline Isabel Prass, Marcos Spellmeier
// September 18, 2018

/* This software constitutes part of the GA for "Eletrônica 4" subject.
 * The files that was written by us are:
 * - Softstarter.c  Softstarter.h
 * - control.c      contro.h
 * - Keyboard.c     Keyboard.h
 * - DAC.c          DAC.h
 * - LED.c          LED.h
 * - Debug.c        Debug.h
 *
 * It's role is to control the voltage level applied to the pin 11 of a
 * TCA785, aiming to control the acceleration and deceleration of a motor
 * when starting or stopping.
 * Also, this software provides functions to configure the time to aceleration's ramps,
 *  visualize motor status through nokia 5110 display and LEDs.
 * 
 * More details on control.c file.
 */

#include "tm4c123gh6pm.h"
#include "PLL.h"
#include "LEDs.h"
#include "control.h"
#include "Keyboard.h"
#include "Nokia5110.h"

/* A Unisinos bitmap image to be displayed on startup */
const unsigned char _logoUni[] ={
 0x42, 0x4D, 0xB6, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x40, 0x08, 0x00, 0x00, 0xC3, 0x0E, 0x00, 0x00, 0xC3, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x80,
 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF,
 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xF0, 0x0F, 0xFF, 0xFF, 0x00, 0xF0, 0x0F, 0xFF, 0xFF, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0x0F, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x0F,
 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00, 0x0F, 0x00,
 0x0F, 0x00, 0xF0, 0x0F, 0x00, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0x0F, 0xFF, 0xFF, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xF0, 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0x0F, 0x00, 0x0F, 0x00, 0x00,
 0x00, 0xF0, 0x00, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x0F, 0xF0, 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0x0F, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xF0, 0x0F, 0xFF, 0xFF, 0x00, 0xF0, 0x0F, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x0F, 0xFF, 0xFF, 0xF0, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x0F, 0xFF, 0xF0, 0xFF, 0xFF,
 0x00, 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0xFF, 0xFF, 0x0F, 0x00, 0x0F, 0x0F, 0xFF, 0x0F, 0xFF, 0xF0, 0xF0, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0xF0, 0x0F, 0x0F, 0x00, 0xFF, 0x00, 0xF0, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0xF0, 0x00,
 0x00, 0x0F, 0x00, 0x00, 0xFF, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0x0F, 0x00, 0xF0, 0x0F,
 0x0F, 0x0F, 0xFF, 0x00, 0xF0, 0x0F, 0x00, 0x00, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x0F,
 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x0F, 0x00, 0x0F, 0xFF, 0x00, 0xF0, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0xF0, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0xF0, 0x00, 0xFF, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0xF0, 0x0F, 0x0F, 0xFF, 0x0F, 0x00, 0xF0, 0x0F, 0x00, 0x00,
 0xF0, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x0F, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F,
 0x00, 0xF0, 0xF0, 0x0F, 0x0F, 0xF0, 0x0F, 0x00, 0xF0, 0x0F, 0x00, 0x00, 0xFF, 0x0F, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0xFF, 0xFF, 0x0F, 0x00, 0x00, 0xFF, 0xFF, 0x0F, 0xFF, 0xFF, 0x0F, 0xFF, 0x00, 0xFF, 0xFF, 0x0F, 0x00, 0x0F, 0x0F, 0xFF, 0x0F, 0xFF, 0xF0, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x0F,
 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0xFF, 0xF0, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0xF0, 0x00, 0xF0, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0xFF, 0xF0,
 0x00, 0x0F, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xF0, 0x0F, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x0F, 0xF0, 0xFF, 0x00, 0x0F, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x0F, 0xF0,
 0xFF, 0xFF, 0x00, 0xF0, 0x0F, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xF0, 0x00, 0x00,
 0xFF, 0x00, 0x0F, 0xF0, 0x0F, 0x00, 0x0F, 0xFF, 0x00, 0xFF, 0x0F, 0x00, 0x0F, 0xFF, 0x00, 0xF0, 0x0F, 0x00, 0x0F, 0xFF, 0x0F, 0xF0, 0x00, 0x0F, 0xF0, 0xF0, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0xFF, 0x00, 0x0F, 0xF0, 0x0F, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0xF0, 0x0F, 0x00, 0xFF, 0xFF,
 0x0F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0xFF, 0x00, 0x0F, 0xF0, 0x0F, 0x0F, 0xFF, 0x0F,
 0x00, 0xFF, 0x0F, 0xFF, 0xFF, 0x00, 0x00, 0xF0, 0x0F, 0x0F, 0xFF, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0xF0, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x0F,
 0xFF, 0xF0, 0x00, 0x00, 0xFF, 0x00, 0x0F, 0xF0, 0x0F, 0xFF, 0xF0, 0x0F, 0x00, 0xFF, 0x0F, 0xFF, 0x00, 0x0F, 0x00, 0xF0, 0x0F, 0xFF, 0xF0, 0x0F, 0x0F, 0xF0, 0x00, 0x0F, 0xF0, 0xFF, 0xF0, 0x00,
 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0xFF, 0x00, 0x0F, 0xF0, 0x0F, 0xFF, 0x00, 0x0F, 0x00, 0xFF, 0x00, 0xFF, 0xF0, 0xFF, 0x00, 0xF0,
 0x0F, 0xFF, 0x00, 0x0F, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x0F, 0xFF, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x0F, 0xFF, 0x00, 0x0F, 0xF0,
 0xFF, 0xF0, 0x00, 0x0F, 0x0F, 0xFF, 0x00, 0x0F, 0xFF, 0xF0, 0x0F, 0xF0, 0xFF, 0xF0, 0x00, 0x0F, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF,
 0xF0, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,

};


// basic functions defined at end of startup.s
void DisableInterrupts(void); // Disable interrupts
void EnableInterrupts(void);  // Enable interrupts

// The main state machine, its possible values and its functions
// ------------------------------------------------------------------
#define SM_INITIALIZING 0
#define SM_OPERATIONAL  1
#define SM_CONFIGURING  2
#define SM_DISPLAY_LOGO 3
unsigned short _state = SM_INITIALIZING;
void executeStateMachine(void);
void initializeRoutine(void);
void operationalRoutine(void);
void configRoutine(void);
void displayLogoRoutine(void);
// ------------------------------------------------------------------

// The main state machine, its possible values and its functions
// ------------------------------------------------------------------
void displayOperationalInfo(void);
void displayConfigInfo(void);
void displayUnisinosLogo(void);
void displayUpdatedMotorState(void);
void displayUpdatedTimeUnit(void);
void displayUpdatedTimes(void);
// ------------------------------------------------------------------

// The defined bounds for the min and max ramp times and a function
// that checks for the bounds and update the values if necessary
// ------------------------------------------------------------------
void checkBounds(void);
const double UPPER_BOUND = 15;
const double LOWER_BOUND = 5;
// ------------------------------------------------------------------

// The current configured times for the ramp
// ------------------------------------------------------------------
double _desiredUpTime   = 5.0;
double _desiredDownTime = 5.0;
// ------------------------------------------------------------------

// The current selected time unit to change the ramp times
// ------------------------------------------------------------------
#define TIME_UNIT_MILLESECONDS  0
#define TIME_UNIT_SECONDS       1
char _currentTimeUnit = 0;
// ------------------------------------------------------------------

// The current selected to be updated time
// ------------------------------------------------------------------
#define UP_TIME   0
#define DOWN_TIME 1
char _currentUpdatingTime = 0;
// ------------------------------------------------------------------

// The last motor status remembered
char _lastMotorStatus = SM_STOPPED;

// index to the delays executed with for loops
int i = 0;

int main(void){
	
	
	// Initialize all the necessary libraries
	// ------------------------------------------------------------------
	PLL_Init();
	LEDs_Init();
	Keyboard_Init();
	Control_Init();
	Nokia5110_Init();
	// ------------------------------------------------------------------
	
	// Show the Unisinos logo on screen and wait sometime.
	// ------------------------------------------------------------------
	displayUnisinosLogo();
	for(i = 0; i<9000000; i++){}
	// ------------------------------------------------------------------
		
  EnableInterrupts(); // Enable interrupts that are used within control.c
	
	// Inifite loop to the main functions
	// ------------------------------------------------------------------
  for(;;) {
		executeStateMachine();
  }
	// ------------------------------------------------------------------
}

// **************executeStateMachine*********************
// Execute the main state machine that repesent the state
// of the system itself not just the motor state
// Input: none
// Output: none
void executeStateMachine(void) {
	switch(_state) {
		case SM_INITIALIZING:
			initializeRoutine();
			break;
		case SM_OPERATIONAL:
			operationalRoutine();
			break;
		case SM_CONFIGURING:
			configRoutine();
			break;
		case SM_DISPLAY_LOGO:
			displayLogoRoutine();
			break;
	}
}

// **************initializeRoutine*********************
// Execute the initialization routine that can be used
// to display some necessary information and perhaps
// sinalize (make an output) that the system has started
// Input: none
// Output: none
void initializeRoutine(void) {
	displayOperationalInfo(); // Display the operational info on the screen
	_state = SM_OPERATIONAL;  // Just change to operational state
}

// **************operationalRoutine*********************
// Execute the operational routine that is the main routine
// This routine read the key events notifying the control.c
// in events occurences. Also, this routine executes some
// display updates.
// Input: none
// Output: none
void operationalRoutine(void) {
	char tempMotorStatus = Control_GetMotorState();
	if(_lastMotorStatus != tempMotorStatus) {
		_lastMotorStatus = tempMotorStatus;
		displayUpdatedMotorState();
	}
	
	switch(Keyboard_In()) {
			case KEY_OP_START_PRESSED:
				Start_Clicked(_desiredUpTime); // Notify control.c that there is a START event
				break;
			case KEY_OP_STOP_PRESSED:
				Stop_Clicked(_desiredDownTime);  // Notify control.c that there is a STOP event
				break;
			case KEY_OP_ENTER_CONFIG:
				displayConfigInfo(); // Display on screen all the configuration information
				_state = SM_CONFIGURING; // Change the state to configuration state
				break;
			case KEY_OP_DISPLAY_LOGO:
				_state = SM_DISPLAY_LOGO; // Change the state to the state taht shows the Unisinos logo
				break;
			default:
				
				break;
		}
}

// ******************configRoutine*************************
// Execute the configuration routine that is the routine
// responsible for allowing the user to change the up and
// down times for the motor's acceleration.
// Also, this routine execute some display updates.
// Input: none
// Output: none
void configRoutine(void){
	
	switch(Keyboard_In()) {
		case KEY_CFG_CHANGE_TIME_UNIT:
			// toogle the current time unit between S and mS
			_currentTimeUnit = !_currentTimeUnit;
			// Call the routine to update this to the screen
			displayUpdatedTimeUnit();
			break;
		case KEY_CFG_CONFIG_OK:
			// If is the first click on it it's just a change of
		  // wich timer is being update. On the second click it
		  // exits the config state and goes to operational again
			if(_currentUpdatingTime == UP_TIME) {
				_currentUpdatingTime = DOWN_TIME;
				displayConfigInfo();
			} else {
				// Update back to up time because this is the default
				_currentUpdatingTime = UP_TIME;
				// update the screen with operational information
				displayOperationalInfo();
				// change the state to the operational one
				_state = SM_OPERATIONAL;
			}
			break;
		default:
			break;
	}
	
	// Execute the continuos read from the keyboard. This feature
	// allows the user to hold the button and the increase/decrease
	// will be executed each time faster while holding pressed the
	// same button
	switch(Keyboard_Continuous_In()) {
			case KEY_CFG_TIME_UP:
				
				if(_currentUpdatingTime == UP_TIME) {
					if(_currentTimeUnit == TIME_UNIT_MILLESECONDS) {
						_desiredUpTime = _desiredUpTime+0.001;
					} else if(_currentTimeUnit == TIME_UNIT_SECONDS) {
						_desiredUpTime++;
					}
				}
				else if(_currentUpdatingTime == DOWN_TIME) {
					if(_currentTimeUnit == TIME_UNIT_MILLESECONDS) {
						_desiredDownTime = _desiredDownTime+0.001;
					} else if(_currentTimeUnit == TIME_UNIT_SECONDS) {
						_desiredDownTime++;
					}
				}
				displayUpdatedTimes();
				break;
				
			case KEY_CFG_TIME_DOWN:
				
				if(_currentUpdatingTime == UP_TIME) {
					if(_currentTimeUnit == TIME_UNIT_MILLESECONDS) {
						_desiredUpTime = _desiredUpTime-0.001;
					} else if(_currentTimeUnit == TIME_UNIT_SECONDS) {
						_desiredUpTime--;
					}
				}
				else if(_currentUpdatingTime == DOWN_TIME) {
					if(_currentTimeUnit == TIME_UNIT_MILLESECONDS) {
						_desiredDownTime = _desiredDownTime-0.001;
					} else if(_currentTimeUnit == TIME_UNIT_SECONDS) {
						_desiredDownTime--;
					}
				}	
				displayUpdatedTimes(); //Update the screen after changing the value
				break;
				
			default:
				break;
		}
}

// ******************displayLogoRoutine*************************
// Execute the routine that is responsible for displaying the
// UNISINOS logo for a few seconds and then go back to operational
// Input: none
// Output: none
void displayLogoRoutine(void) {
	displayUnisinosLogo();
	for(i = 0; i<5000000; i++){}
	_state = SM_INITIALIZING;
}



//----------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------
//------------      BELLOW ARE DISPLAY USEFULL UPDATE FUNCTIONS TO THE NOKIA WITH THIS SOFTSTARTER FILE           ------------
//----------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------

// ******************displayOperationalInfo*************************
// This function update the whole display screen with the operational
// information, like motor status and configured timers.
// Input: none
// Output: none
void displayOperationalInfo(void) {
	Nokia5110_Clear();
	Nokia5110_OutString("Operational ");
	Nokia5110_OutString("------------");

	switch(_lastMotorStatus) {
		case SM_STARTED:
			Nokia5110_OutString("  STARTED   ");
			break;
		case SM_STOPPED:
			Nokia5110_OutString("  STOPPED   ");
			break;
		case SM_STARTING:
			Nokia5110_OutString("  STARTING  ");
			break;
		case SM_STOPPING:
			Nokia5110_OutString("  STOPPING  ");
			break;
		default:
			break;
	}

	Nokia5110_OutString("------------");
	Nokia5110_OutString("UP:   ");
	Nokia5110_OutDouble(_desiredUpTime);
	Nokia5110_OutString("DOWN: ");
	Nokia5110_OutDouble(_desiredDownTime);
}

// ******************displayConfigInfo*************************
// This function update the whole display screen with the configuration
// information, configured timers, current selected time unit, current
// selected timer to be updated.
// Input: none
// Output: none
void displayConfigInfo(void) {
	Nokia5110_Clear();
	Nokia5110_OutString("Config MENU:");
	Nokia5110_OutString("------------");
	Nokia5110_OutString("Time Unit:");
	if(_currentTimeUnit) Nokia5110_OutString(" S");
	if(!_currentTimeUnit) Nokia5110_OutString("mS");
	Nokia5110_OutString("            ");
	if(_currentUpdatingTime == UP_TIME) {
		Nokia5110_OutString("*UP:  ");
		Nokia5110_OutDouble(_desiredUpTime);
		Nokia5110_OutString("DOWN: ");
		Nokia5110_OutDouble(_desiredDownTime);
	} else {
		Nokia5110_OutString("UP:   ");
		Nokia5110_OutDouble(_desiredUpTime);
		Nokia5110_OutString("*DOWN:");
		Nokia5110_OutDouble(_desiredDownTime);
	}
	
}

// ******************displayUpdatedMotorState*************************
// This function provides a way to update a specific display position, 
// more precisely, the motor state position. It's update with the new state
// Input: none
// Output: none
void displayUpdatedMotorState(void) {
	Nokia5110_SetCursor(0, 2);
	switch(_lastMotorStatus) {
		case SM_STARTED:
			Nokia5110_OutString("  STARTED   ");
			break;
		case SM_STOPPED:
			Nokia5110_OutString("  STOPPED   ");
			break;
		case SM_STARTING:
			Nokia5110_OutString("  STARTING  ");
			break;
		case SM_STOPPING:
			Nokia5110_OutString("  STOPPING  ");
			break;
		default:
			break;
	}
}

// **************displayUpdatedTimeUnit*********************
// This function updates on the screen just the current 
// selected time unit to be used within time up and down
// Input: none
// Output: none
void displayUpdatedTimeUnit(void) {
	Nokia5110_SetCursor(10, 2);
	if(_currentTimeUnit) Nokia5110_OutString(" S");
	if(!_currentTimeUnit) Nokia5110_OutString("mS");
}

// **************displayUpdatedTimes*********************
// This function updates on the screen just the current 
// timers. Can be called after their changes
// Input: none
// Output: none
void displayUpdatedTimes(void) {
	checkBounds();
	Nokia5110_SetCursor(6, 4);
	Nokia5110_OutDouble(_desiredUpTime);
	Nokia5110_SetCursor(6, 5);
	Nokia5110_OutDouble(_desiredDownTime);
}

// **************displayUnisinosLogo*********************
// This function clears the whole screen and update it
// with a full 84x48 bmp UNISINOS logo image
// Input: none
// Output: none
void displayUnisinosLogo(void) {
	Nokia5110_Clear();
	Nokia5110_PrintBMP(0, 47, _logoUni, 0);
	Nokia5110_DisplayBuffer();
}

// **************checkBounds*********************
// This functions checks and update the current
// timers values, according to their relations
// with the specified bounds for them.
// Input: none
// Output: none
void checkBounds(void) {
	if(_desiredUpTime > UPPER_BOUND) {
		_desiredUpTime = UPPER_BOUND;
	} else if(_desiredUpTime < LOWER_BOUND) {
		_desiredUpTime = LOWER_BOUND;
	}
	if(_desiredDownTime > UPPER_BOUND) {
		_desiredDownTime = UPPER_BOUND;
	} else if(_desiredDownTime < LOWER_BOUND) {
		_desiredDownTime = LOWER_BOUND;
	}
}
